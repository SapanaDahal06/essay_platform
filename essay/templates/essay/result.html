<!-- essay/templates/essay/essay_results.html -->
{% extends 'essay/base.html' %}
{% load static %}

{% block title %}Essay Results - {{ essay.title }}{% endblock %}

{% block extra_css %}
<style>
    .results-container {
        max-width: 1200px;
        margin: 40px auto;
        padding: 0 20px;
    }
    
    .score-card {
        background: linear-gradient(135deg, #4CAF50, #8BC34A);
        color: white;
        padding: 40px;
        border-radius: 20px;
        text-align: center;
        margin-bottom: 40px;
        box-shadow: 0 10px 30px rgba(76, 175, 80, 0.3);
    }
    
    .total-score {
        font-size: 5rem;
        font-weight: 700;
        margin-bottom: 10px;
    }
    
    .grade-badge {
        display: inline-block;
        padding: 10px 25px;
        background: rgba(255, 255, 255, 0.2);
        border-radius: 50px;
        font-size: 1.5rem;
        font-weight: 600;
        margin-bottom: 20px;
    }
    
    .metrics-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 20px;
        margin-bottom: 40px;
    }
    
    .metric-card {
        background: white;
        padding: 25px;
        border-radius: 15px;
        text-align: center;
        box-shadow: 0 5px 15px rgba(0,0,0,0.08);
        border: 2px solid #f5f5f5;
    }
    
    .metric-value {
        font-size: 2.5rem;
        font-weight: 700;
        margin-bottom: 10px;
    }
    
    .metric-good {
        color: #4CAF50;
    }
    
    .metric-warning {
        color: #FF9800;
    }
    
    .metric-bad {
        color: #F44336;
    }
    
    .feedback-section {
        background: white;
        border-radius: 15px;
        padding: 30px;
        margin-bottom: 30px;
        box-shadow: 0 5px 15px rgba(0,0,0,0.08);
    }
    
    .issue-item {
        background: #FFF3E0;
        padding: 15px;
        border-radius: 10px;
        margin-bottom: 10px;
        border-left: 4px solid #FF9800;
    }
    
    .suggestions {
        background: #E8F5E9;
        padding: 10px 15px;
        border-radius: 8px;
        margin-top: 10px;
        font-size: 0.9rem;
    }
    
    .progress-container {
        margin: 20px 0;
    }
    
    .progress-bar {
        height: 10px;
        background: #f0f0f0;
        border-radius: 5px;
        overflow: hidden;
        margin: 10px 0;
    }
    
    .progress-fill {
        height: 100%;
        transition: width 0.5s ease;
    }
    
    .grammar-progress {
        background: linear-gradient(90deg, #FF9800, #FFC107);
    }
    
    .spelling-progress {
        background: linear-gradient(90deg, #F44336, #EF5350);
    }
    
    .content-progress {
        background: linear-gradient(90deg, #2196F3, #03A9F4);
    }
</style>
{% endblock %}

{% block content %}
<div class="results-container">
    <!-- Score Header -->
    <div class="score-card">
        <h1 style="font-size: 2rem; margin-bottom: 20px;">üéØ Essay Analysis Results</h1>
        <div class="total-score">{{ analysis.total_score|default:"0" }}/100</div>
        <div class="grade-badge">{{ analysis.grade|default:"N/A" }}</div>
        <h2 style="margin-bottom: 10px;">{{ essay.title }}</h2>
        <p style="opacity: 0.9; font-size: 1.1rem;">
            {{ essay.word_count|default:"0" }} words ‚Ä¢ {{ essay.category|title }}
        </p>
    </div>
    
    <!-- Metrics Grid -->
    <div class="metrics-grid">
        <div class="metric-card">
            <div class="metric-value metric-good">{{ analysis.grammar_score|default:"0" }}/30</div>
            <h3>Grammar</h3>
            <div class="progress-container">
                <div class="progress-bar">
                    <div class="progress-fill grammar-progress" style="width: {{ analysis.grammar_score|default:0|floatformat:0 }}%;"></div>
                </div>
                <small>{{ analysis.grammar_issues|default:"0" }} issues found</small>
            </div>
        </div>
        
        <div class="metric-card">
            <div class="metric-value {% if analysis.spelling_score >= 15 %}metric-good{% elif analysis.spelling_score >= 10 %}metric-warning{% else %}metric-bad{% endif %}">
                {{ analysis.spelling_score|default:"0" }}/20
            </div>
            <h3>Spelling</h3>
            <div class="progress-container">
                <div class="progress-bar">
                    <div class="progress-fill spelling-progress" style="width: {{ analysis.spelling_score|default:0|floatformat:0 }}%;"></div>
                </div>
                <small>{{ analysis.spelling_issues|default:"0" }} issues found</small>
            </div>
        </div>
        
        <div class="metric-card">
            <div class="metric-value metric-good">{{ analysis.content_score|default:"0" }}/50</div>
            <h3>Content Quality</h3>
            <div class="progress-container">
                <div class="progress-bar">
                    <div class="progress-fill content-progress" style="width: {{ analysis.content_score|default:0|floatformat:0 }}%;"></div>
                </div>
                <small>{{ essay.word_count|default:"0" }} words, {{ analysis.sentence_count|default:"0" }} sentences</small>
            </div>
        </div>
        
        <div class="metric-card">
            <div class="metric-value">{{ analysis.word_count|default:"0" }}</div>
            <h3>Word Count</h3>
            <div class="progress-container">
                <div style="margin: 15px 0;">
                    {% if analysis.word_count >= 500 %}
                        <span style="color:#4CAF50;">‚úÖ Excellent length</span>
                    {% elif analysis.word_count >= 300 %}
                        <span style="color:#8BC34A;">üëç Good length</span>
                    {% elif analysis.word_count >= 200 %}
                        <span style="color:#FF9800;">‚ö†Ô∏è Average length</span>
                    {% else %}
                        <span style="color:#F44336;">‚ùå Too short</span>
                    {% endif %}
                </div>
                <small>Recommended: 300-500 words</small>
            </div>
        </div>
    </div>
    
    <!-- Grammar & Spelling Issues -->
    <div class="feedback-section">
        <h3 style="margin-bottom: 20px; color: #5D4037;">üîç Grammar & Spelling Feedback</h3>
        
        {% if analysis.grammar_feedback %}
            <h4 style="color: #FF9800; margin-bottom: 15px;">Issues Found ({{ analysis.grammar_issues|default:"0"|add:analysis.spelling_issues|default:"0" }}):</h4>
            {% for issue in analysis.grammar_feedback %}
            <div class="issue-item">
                <strong>{{ forloop.counter }}. {{ issue.message }}</strong>
                <p style="margin: 8px 0; color: #5D4037;">Context: "{{ issue.context }}"</p>
                {% if issue.suggestions %}
                <div class="suggestions">
                    <strong>Suggestions:</strong>
                    {% for suggestion in issue.suggestions %}
                    <span style="background: #C8E6C9; padding: 3px 8px; border-radius: 4px; margin: 0 5px 5px 0; display: inline-block;">
                        {{ suggestion }}
                    </span>
                    {% endfor %}
                </div>
                {% endif %}
            </div>
            {% endfor %}
        {% else %}
            <div style="text-align: center; padding: 30px; color: #4CAF50;">
                <div style="font-size: 3rem; margin-bottom: 15px;">‚úÖ</div>
                <h3>No Grammar or Spelling Issues Found!</h3>
                <p>Your essay looks great in terms of grammar and spelling.</p>
            </div>
        {% endif %}
    </div>
    
    <!-- Content Analysis -->
    <div class="feedback-section">
        <h3 style="margin-bottom: 20px; color: #5D4037;">üìä Content Analysis</h3>
        
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px;">
            <div style="text-align: center;">
                <div style="font-size: 2.5rem; color: #2196F3; font-weight: bold;">
                    {{ analysis.word_count|default:"0" }}
                </div>
                <div>Total Words</div>
            </div>
            
            <div style="text-align: center;">
                <div style="font-size: 2.5rem; color: #2196F3; font-weight: bold;">
                    {{ analysis.sentence_count|default:"0" }}
                </div>
                <div>Sentences</div>
            </div>
            
            <div style="text-align: center;">
                <div style="font-size: 2.5rem; color: #2196F3; font-weight: bold;">
                    {{ analysis.unique_words|default:"0" }}
                </div>
                <div>Unique Words</div>
            </div>
            
            <div style="text-align: center;">
                <div style="font-size: 2.5rem; color: #2196F3; font-weight: bold;">
                    {{ analysis.avg_sentence_length|default:"0"|floatformat:1 }}
                </div>
                <div>Avg. Sentence Length</div>
            </div>
        </div>
        
        <div style="margin-top: 25px; padding: 20px; background: #E3F2FD; border-radius: 10px;">
            <h4 style="color: #1976D2; margin-bottom: 10px;">üìù Writing Tips:</h4>
            <ul style="margin: 0; padding-left: 20px;">
                {% if analysis.word_count < 300 %}
                <li>Try to write at least 300 words for a comprehensive essay</li>
                {% endif %}
                {% if analysis.avg_sentence_length > 30 %}
                <li>Some sentences are too long. Try breaking them up for better readability</li>
                {% elif analysis.avg_sentence_length < 10 %}
                <li>Some sentences are very short. Try combining ideas for better flow</li>
                {% endif %}
                {% if analysis.grammar_issues > 5 %}
                <li>Review grammar rules and consider proofreading more carefully</li>
                {% endif %}
                <li>Vary your sentence structure for more engaging writing</li>
                <li>Use transitional words to connect ideas between paragraphs</li>
            </ul>
        </div>
    </div>
    
    <!-- Actions -->
    <div style="display: flex; gap: 15px; justify-content: center; margin-top: 40px;">
        <a href="{% url 'edit_essay' essay.id %}" style="background: #FF9800; color: white; padding: 15px 30px; border-radius: 8px; text-decoration: none; font-weight: 600;">
            ‚úèÔ∏è Edit Essay
        </a>
        <a href="{% url 'essay_detail' essay.id %}" style="background: #2196F3; color: white; padding: 15px 30px; border-radius: 8px; text-decoration: none; font-weight: 600;">
            üëÅÔ∏è View Essay
        </a>
        <a href="{% url 'leaderboard' %}" style="background: #4CAF50; color: white; padding: 15px 30px; border-radius: 8px; text-decoration: none; font-weight: 600;">
            üèÜ View Leaderboard
        </a>
    </div>
</div>

<script>
    // Animate progress bars
    document.addEventListener('DOMContentLoaded', function() {
        const progressBars = document.querySelectorAll('.progress-fill');
        progressBars.forEach(bar => {
            const width = bar.style.width;
            bar.style.width = '0%';
            setTimeout(() => {
                bar.style.width = width;
            }, 300);
        });
    });
</script>
{% endblock %}