{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="WriteVerse - Where writers compete, grow, and showcase their talent through essay competitions.">
    <meta name="theme-color" content="#2563eb">
    
    <!-- Open Graph / Social Media Meta Tags -->
    <meta property="og:title" content="WriteVerse - Where Writers Compete & Grow">
    <meta property="og:description" content="Transform your writing into success stories. Join our community of writers competing in essay challenges.">
    <meta property="og:image" content="{% static 'essay/images/og-image.png' %}">
    <meta property="og:url" content="{{ request.build_absolute_uri }}">
    
    <title>{% block title %}WriteVerse - Where Writers Compete & Grow{% endblock %}</title>

    <!-- Preload Critical Assets -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="{% static 'essay/images/logo.svg' %}">
    <link rel="apple-touch-icon" href="{% static 'essay/images/apple-touch-icon.png' %}">
    <link rel="manifest" href="{% static 'essay/site.webmanifest' %}">

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&family=Poppins:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
    
    <!-- Custom CSS -->
    <link rel="stylesheet" href="{% static 'essay/css/styles.css' %}?v=3.0">
    
    {% block extra_css %}{% endblock %}

    <!-- Prevent Flash of Unstyled Content -->
    <style>
        .js-loading * {
            animation-play-state: paused !important;
        }
        
        body {
            opacity: 0;
            transition: opacity 0.3s ease;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }
        
        body.loaded {
            opacity: 1;
        }
        
        .main-content {
            flex: 1 0 auto;
        }
        
        .footer {
            flex-shrink: 0;
        }
    </style>
</head>
<body class="js-loading">
    
    <!-- Loading Spinner -->
    <div id="pageLoader" class="page-loader">
        <div class="loader-content">
            <div class="loader-spinner"></div>
            <div class="loader-text">WriteVerse</div>
        </div>
    </div>

    <!-- Navigation Bar -->
    <nav class="navbar" role="navigation" aria-label="Main navigation">
        <div class="nav-container">
            <!-- Logo -->
            <a href="{% url 'home' %}" class="logo" aria-label="WriteVerse Home">
                <div class="logo-icon">
                    <i class="fas fa-feather-alt"></i>
                </div>
                <span class="logo-text">
                    Write<span class="logo-highlight">Verse</span>
                </span>
            </a>

            <!-- Desktop Menu -->
            <div class="nav-menu" role="menubar">
                <a href="{% url 'home' %}" class="nav-link {% if request.path == '/' %}active{% endif %}" role="menuitem">
                    <i class="fas fa-home"></i>
                    <span>Home</span>
                </a>
                <a href="{% url 'about' %}" class="nav-link {% if 'about' in request.path %}active{% endif %}" role="menuitem">
                    <i class="fas fa-info-circle"></i>
                    <span>About</span>
                </a>
                <a href="{% url 'essay_list' %}" class="nav-link {% if 'essays' in request.path %}active{% endif %}" role="menuitem">
                    <i class="fas fa-book-open"></i>
                    <span>Competitions</span>
                </a>
                <a href="{% url 'community' %}" class="nav-link {% if 'community' in request.path %}active{% endif %}" role="menuitem">
                    <i class="fas fa-users"></i>
                    <span>Community</span>
                </a>
                <a href="{% url 'leaderboard' %}" class="nav-link {% if 'leaderboard' in request.path %}active{% endif %}" role="menuitem">
                    <i class="fas fa-trophy"></i>
                    <span>Leaderboard</span>
                </a>
            </div>

            <!-- User Actions -->
            <div class="nav-actions">
                {% if user.is_authenticated %}
                    <!-- Notification Bell -->
                    <button class="notification-btn" aria-label="Notifications" id="notificationBtn">
                        <i class="fas fa-bell"></i>
                        <span class="notification-badge">3</span>
                    </button>

                    <!-- Create Essay Button -->
                    <a href="{% url 'create_essay' %}" class="btn btn-primary" aria-label="Create new essay">
                        <i class="fas fa-pen-fancy"></i>
                        <span>Write Essay</span>
                    </a>
                    
                    <!-- User Dropdown -->
                    <div class="user-dropdown">
                        <button class="user-btn" aria-haspopup="true" aria-expanded="false" id="userMenuBtn">
                            <div class="user-avatar">
                                {% if user.profile.avatar %}
                                    <img src="{{ user.profile.avatar.url }}" alt="{{ user.username }}">
                                {% else %}
                                    <i class="fas fa-user"></i>
                                {% endif %}
                            </div>
                            <span class="user-name">{{ user.username|truncatechars:12 }}</span>
                            <i class="fas fa-chevron-down dropdown-arrow"></i>
                        </button>
                        <div class="dropdown-menu" role="menu" id="userMenu" aria-labelledby="userMenuBtn">
                            <div class="dropdown-header">
                                <div class="user-avatar-large">
                                    {% if user.profile.avatar %}
                                        <img src="{{ user.profile.avatar.url }}" alt="{{ user.username }}">
                                    {% else %}
                                        <i class="fas fa-user"></i>
                                    {% endif %}
                                </div>
                                <div class="user-info">
                                    <strong>{{ user.username }}</strong>
                                    <span>{{ user.email }}</span>
                                </div>
                            </div>
                            <div class="dropdown-divider"></div>
                            <a href="{% url 'dashboard' %}" class="dropdown-item" role="menuitem">
                                <i class="fas fa-tachometer-alt"></i> 
                                <span>Dashboard</span>
                            </a>
                            <a href="{% url 'profile' user.username %}" class="dropdown-item" role="menuitem">
                                <i class="fas fa-user-circle"></i> 
                                <span>My Profile</span>
                            </a>
                            <a href="{% url 'my_essays' %}" class="dropdown-item" role="menuitem">
                                <i class="fas fa-file-alt"></i> 
                                <span>My Essays</span>
                            </a>
                            <a href="{% url 'analytics' %}" class="dropdown-item" role="menuitem">
                                <i class="fas fa-chart-line"></i> 
                                <span>Analytics</span>
                            </a>
                            <div class="dropdown-divider"></div>
                            <a href="{% url 'settings' %}" class="dropdown-item" role="menuitem">
                                <i class="fas fa-cog"></i> 
                                <span>Settings</span>
                            </a>
                            <form method="post" action="{% url 'logout' %}" style="width: 100%;">
                                {% csrf_token %}
                                <button type="submit" class="dropdown-item logout" role="menuitem">
                                    <i class="fas fa-sign-out-alt"></i> 
                                    <span>Logout</span>
                                </button>
                            </form>
                        </div>
                    </div>
                {% else %}
                    <a href="{% url 'login' %}" class="btn btn-ghost" aria-label="Login to your account">
                        <i class="fas fa-sign-in-alt"></i>
                        <span>Login</span>
                    </a>
                    <a href="{% url 'register' %}" class="btn btn-primary" aria-label="Create new account">
                        <i class="fas fa-user-plus"></i>
                        <span>Sign Up Free</span>
                    </a>
                {% endif %}
            </div>

            <!-- Mobile Menu Button -->
            <button class="mobile-menu-btn" id="mobileMenuBtn" aria-label="Toggle mobile menu" aria-expanded="false">
                <span class="hamburger"></span>
            </button>
        </div>

        <!-- Mobile Menu -->
        <div class="mobile-menu" id="mobileMenu">
            <div class="mobile-menu-content">
                <a href="{% url 'home' %}" class="mobile-nav-link {% if request.path == '/' %}active{% endif %}">
                    <i class="fas fa-home"></i>
                    <span>Home</span>
                </a>
                <a href="{% url 'about' %}" class="mobile-nav-link {% if 'about' in request.path %}active{% endif %}">
                    <i class="fas fa-info-circle"></i>
                    <span>About</span>
                </a>
                <a href="{% url 'essay_list' %}" class="mobile-nav-link {% if 'essays' in request.path %}active{% endif %}">
                    <i class="fas fa-book-open"></i>
                    <span>Competitions</span>
                </a>
                <a href="{% url 'community' %}" class="mobile-nav-link {% if 'community' in request.path %}active{% endif %}">
                    <i class="fas fa-users"></i>
                    <span>Community</span>
                </a>
                <a href="{% url 'leaderboard' %}" class="mobile-nav-link {% if 'leaderboard' in request.path %}active{% endif %}">
                    <i class="fas fa-trophy"></i>
                    <span>Leaderboard</span>
                </a>

                {% if user.is_authenticated %}
                    <div class="mobile-divider"></div>
                    <a href="{% url 'create_essay' %}" class="mobile-nav-link mobile-cta">
                        <i class="fas fa-pen-fancy"></i>
                        <span>Write Essay</span>
                    </a>
                    <a href="{% url 'dashboard' %}" class="mobile-nav-link">
                        <i class="fas fa-tachometer-alt"></i>
                        <span>Dashboard</span>
                    </a>
                    <a href="{% url 'profile' user.username %}" class="mobile-nav-link">
                        <i class="fas fa-user-circle"></i>
                        <span>Profile</span>
                    </a>
                    <form method="post" action="{% url 'logout' %}">
                        {% csrf_token %}
                        <button type="submit" class="mobile-nav-link logout">
                            <i class="fas fa-sign-out-alt"></i>
                            <span>Logout</span>
                        </button>
                    </form>
                {% else %}
                    <div class="mobile-divider"></div>
                    <div class="mobile-auth">
                        <a href="{% url 'login' %}" class="mobile-login-btn">
                            <i class="fas fa-sign-in-alt"></i>
                            Login
                        </a>
                        <a href="{% url 'register' %}" class="mobile-register-btn">
                            <i class="fas fa-user-plus"></i>
                            Sign Up Free
                        </a>
                    </div>
                {% endif %}
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="main-content" role="main">
        <!-- Toast Notifications Container -->
        <div class="toast-container" id="toastContainer"></div>

        <!-- Messages -->
        {% if messages %}
            <div class="messages-container">
                {% for message in messages %}
                    <div class="alert alert-{{ message.tags }}" role="alert">
                        <i class="fas fa-{% if message.tags == 'success' %}check-circle{% elif message.tags == 'error' %}exclamation-circle{% elif message.tags == 'warning' %}exclamation-triangle{% else %}info-circle{% endif %}"></i>
                        <span>{{ message }}</span>
                        <button class="alert-close" aria-label="Close alert">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                {% endfor %}
            </div>
        {% endif %}

        <!-- Page Content -->
        {% block content %}
        <!-- Content will be injected here -->
        {% endblock %}
    </main>

    <!-- Footer -->
    <footer class="footer modern-footer" role="contentinfo">
        <div class="footer-container">
            <div class="footer-content">
                <div class="footer-section footer-brand">
                    <div class="footer-logo">
                        <i class="fas fa-feather-alt"></i>
                        <span>Write<span class="logo-highlight">Verse</span></span>
                    </div>
                    <p class="footer-description">
                        Empowering writers worldwide to compete, grow, and showcase their talent through engaging essay competitions.
                    </p>
                    <div class="social-links">
                        <a href="#" class="social-link" aria-label="Twitter" title="Follow us on Twitter">
                            <i class="fab fa-twitter"></i>
                        </a>
                        <a href="#" class="social-link" aria-label="Facebook" title="Follow us on Facebook">
                            <i class="fab fa-facebook"></i>
                        </a>
                        <a href="#" class="social-link" aria-label="Instagram" title="Follow us on Instagram">
                            <i class="fab fa-instagram"></i>
                        </a>
                        <a href="#" class="social-link" aria-label="Discord" title="Join our Discord">
                            <i class="fab fa-discord"></i>
                        </a>
                        <a href="#" class="social-link" aria-label="LinkedIn" title="Connect on LinkedIn">
                            <i class="fab fa-linkedin"></i>
                        </a>
                    </div>
                </div>
                
                <div class="footer-section">
                    <h4>Platform</h4>
                    <ul class="footer-links">
                        <li><a href="{% url 'home' %}">Home</a></li>
                        <li><a href="{% url 'about' %}">About Us</a></li>
                        <li><a href="{% url 'essay_list' %}">Competitions</a></li>
                        <li><a href="{% url 'leaderboard' %}">Leaderboard</a></li>
                    </ul>
                </div>
                
                <div class="footer-section">
                    <h4>Community</h4>
                    <ul class="footer-links">
                        <li><a href="{% url 'community' %}">Forum</a></li>
                        <li><a href="{% url 'about' %}">How It Works</a></li>
                        <li><a href="{% url 'about' %}">Success Stories</a></li>
                        <li><a href="{% url 'faq' %}">FAQ</a></li>
                    </ul>
                </div>
                
                <div class="footer-section">
                    <h4>Support</h4>
                    <ul class="footer-links">
                        <li><a href="{% url 'help' %}">Help Center</a></li>
                        <li><a href="{% url 'contact' %}">Contact Us</a></li>
                        <li><a href="{% url 'privacy' %}">Privacy Policy</a></li>
                        <li><a href="{% url 'terms' %}">Terms of Service</a></li>
                    </ul>
                </div>
            </div>
            
            <div class="footer-bottom">
                <p>&copy; <span id="currentYear"></span> WriteVerse. All rights reserved.</p>
                <p class="footer-tagline">Crafted with <i class="fas fa-heart"></i> for writers everywhere</p>
            </div>
        </div>
    </footer>

    <!-- Back to Top Button -->
    <button class="back-to-top" id="backToTop" aria-label="Back to top">
        <i class="fas fa-arrow-up"></i>
    </button>

    <!-- Base JavaScript -->
    <script src="{% static 'essay/js/main.js' %}?v=1.0"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            document.body.classList.remove('js-loading');
            document.getElementById('currentYear').textContent = new Date().getFullYear();
            
            // Mobile menu
            const mobileMenuBtn = document.getElementById('mobileMenuBtn');
            const mobileMenu = document.getElementById('mobileMenu');
            
            if (mobileMenuBtn && mobileMenu) {
                mobileMenuBtn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    const isExpanded = this.getAttribute('aria-expanded') === 'true';
                    this.setAttribute('aria-expanded', !isExpanded);
                    this.classList.toggle('active');
                    mobileMenu.classList.toggle('active');
                    document.body.classList.toggle('menu-open');
                });

                document.addEventListener('click', function(event) {
                    if (!mobileMenu.contains(event.target) && !mobileMenuBtn.contains(event.target)) {
                        mobileMenu.classList.remove('active');
                        mobileMenuBtn.classList.remove('active');
                        mobileMenuBtn.setAttribute('aria-expanded', 'false');
                        document.body.classList.remove('menu-open');
                    }
                });
            }

            // User dropdown
            const userMenuBtn = document.getElementById('userMenuBtn');
            const userMenu = document.getElementById('userMenu');
            
            if (userMenuBtn && userMenu) {
                userMenuBtn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    const isExpanded = this.getAttribute('aria-expanded') === 'true';
                    this.setAttribute('aria-expanded', !isExpanded);
                    userMenu.classList.toggle('show');
                });

                document.addEventListener('click', function(e) {
                    if (!userMenuBtn.contains(e.target) && !userMenu.contains(e.target)) {
                        userMenu.classList.remove('show');
                        userMenuBtn.setAttribute('aria-expanded', 'false');
                    }
                });
            }

            // Back to top
            const backToTop = document.getElementById('backToTop');
            if (backToTop) {
                window.addEventListener('scroll', function() {
                    if (window.pageYOffset > 300) {
                        backToTop.classList.add('visible');
                    } else {
                        backToTop.classList.remove('visible');
                    }
                });

                backToTop.addEventListener('click', function() {
                    window.scrollTo({ top: 0, behavior: 'smooth' });
                });
            }

            // Alerts
            document.querySelectorAll('.alert-close').forEach(button => {
                button.addEventListener('click', function() {
                    const alert = this.closest('.alert');
                    if (alert) {
                        alert.style.opacity = '0';
                        setTimeout(() => alert.remove(), 300);
                    }
                });
            });

            setTimeout(() => {
                document.body.classList.add('loaded');
                document.getElementById('pageLoader').style.opacity = '0';
                setTimeout(() => {
                    document.getElementById('pageLoader').style.display = 'none';
                }, 300);
            }, 300);
        });
    </script>

    {% block extra_js %}{% endblock %}
</body>
</html>